/*
@title: 
@author: 
@tags: []
@addedOn: 2024-00-00
*/

const player = "p"
const bowl = "b"

const sausage = "s"
const ham = "h"
const bone = "n"
const chocolate = "c"

const tileLeft = "Q"
const tileRight = "W"
const tileUp = "E"
const tileDown = "R"
const tileCorner = "T"
const tileOrnament = "Z"

const button1 = "1"
const button2 = "2"
const button3 = "3"
const button4 = "4"
const button5 = "5"
const button6 = "6"
const button7 = "7"
const button8 = "8"
const lifeIndicator = "9"
const life = "0"
const button11 = "-"

setLegend(
  [player, bitmap`
................
.......111......
.....11CCC11....
...11CCCCCCC11..
..1CCCCCCCCCCC1.
..1CC0CCCCC0CC1.
.11CCCC000CCCC1.
1C1CCC20002CCC1.
1C1CC1220221CC1.
12111100200111..
1222166666661...
.12CCCCCCCCCC1..
.1CCCCCCCCCCCC1.
.1CCCC22CCC22CC1
.12CCC22CCC22CC1
122CC222CCC222C1`],
  [sausage, bitmap`
................
................
...........CCCC.
...........C32CC
..........CC332C
..........C3332C
.........CCC323C
.......CCC33C3CC
......CC33C33CC.
.CCCCCC3333C3C..
C333C33C333CC...
C3233C333CCC....
.C323333CC......
..CCCCCC........
................
................`],
  [bowl, bitmap`
................
................
................
................
................
................
................
...CCCCCCCCCC...
..CCFFFFFFFFCC..
.CFFFFFFFFFFFFC.
.CCCFFFFFFFFCCC.
.C9CCCCCCCCCC2C.
.CF9F9F9F9F229C.
.C9F9F9F9F9F9FC.
..C9F9F9F9F9FC..
...CCCCCCCCCC...`],
  [ham, bitmap`
................
................
................
88333...........
8822333......11.
88823333....1221
8883333311112221
288323332222221.
288333330LL12221
88833333....1221
88833333.....LL.
8833333.........
88333...........
................
................
................`],
  [chocolate, bitmap`
................
....CCCC........
...CC22CC.......
..CCCCC2CC......
.CCCCCCC2CCL....
.CCCCCCCCCL1LL..
.CCCCCCC212331..
..CCCCCL133333..
...CCCC12133633.
...LCC112333363.
...LLL1213333933
..11L11333333393
...21L1333333933
.....11.3333933.
.........33333..
..........333...`],
  [bone, bitmap`
................
................
................
................
.11..........11.
1221........1221
1222111111112221
.12222222222221.
L221LLLLLLLL1221
L11L........L221
.LL..........L1.
................
................
................
................
................`],
  // Tiles
  [tileLeft, bitmap`
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666`],
  [tileRight, bitmap`
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660`],
  [tileUp, bitmap`
0000000000000000
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666`],
  [tileDown, bitmap`
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
0000000000000000
FFFFFFFFFFFFFFFF
FFFFFFFFFFFFFFFF
FFFFFFFFFFFFFFFF
FFFFFFFFFFFFFFFF
0000000000000000`],
  [tileCorner, bitmap`
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF00000000000
0FFF0FFFFFFFFFFF
0FF0FFFFFFFFFFFF
0F0FFFFFFFFFFFFF
00FFFFFFFFFFFFFF
0000000000000000`],
  [tileOrnament, bitmap`
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
0000000000000000
FFFFFFFFFFFFFFFF
FFFFFFFFFFFFFFFF
0000000000000000`],
  // Buttons
  [button1, bitmap`
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666
6666666666666666`],
  [button2, bitmap`
0000066666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666
0FFFF66666666666`],
  [button3, bitmap`
0000000000000000
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666
0FFFF06666666666`],
  [button4, bitmap`
0000000000000000
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660`],
  [button5, bitmap`
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
6666666666666660
0000000000000000
FFFFFFFFFFFFFFF0
FFFFFFFFFFFFFFF0
FFFFFFFFFFFFFFF0
FFFFFFFFFFFFFFF0
0000000000000000`],
  [button6, bitmap`
6666666666666666
6666666666666666
6666666666666666
666688888888FF66
666688882228FFF6
66618H888828LFF6
66118H888888LLF6
66118H8888880LF6
66118H8888880LF6
66118HHHHH880LF6
6611888888880166
6611LLLLLLLL1166
6661111111111666
66666666FFFF6666
6666666666666666
6666666666666666`],
  [button7, bitmap`.`],
  [button8, bitmap`.`],
  [lifeIndicator, bitmap`
6666666666666666
6666666666666666
6668886666888666
6683338668333866
6833323883322386
6833332333332386
8333333333333238
8333333333333338
8333323333233338
6833332222333386
6833323333233386
6683333333333866
6668333333338666
6666883333886666
6666668338666666
6666666886666666`],
  [life, bitmap`
................
................
...888....888...
..83338..83338..
.83332388332238.
.83333233333238.
8333333333333238
8333333333333338
8333323333233338
.83333222233338.
.83332333323338.
..833333333338..
...8333333338...
....88333388....
......8338......
.......88.......`],
  [button11, bitmap`
6666666666666660
6666666666666660
6666666666666660
666688888888FF60
666688882228FFF0
66618H888828LFF0
66118H888888LLF0
66118H8888880LF0
66118H8888880LF0
66118HHHHH880LF0
6611888888880160
6611LLLLLLLL1160
6661111111111660
66666666FFFF6660
6666666666666660
6666666666666660`],
  // Others
)

const fallingObjects = [sausage, ham, bone, chocolate, life]

setSolids([
  tileLeft, tileRight, tileUp, tileDown, tileCorner, tileOrnament,
  button1, button2, button3, button4, button5, button6, button7, button8, lifeIndicator, button11,
])

const melody = tune`
375,
375: C5^375 + E4~375,
375: C5^375 + G4~375,
375: C5^375 + E4~375,
375: G4^375,
375: A4^375 + E4~375,
375: A4^375 + G4~375,
375: G4^375 + E4~375,
375,
375: E5^375 + E4~375,
375: E5^375 + G4~375,
375: D5^375 + E4~375,
375: D5^375,
375: C5^375 + E4~375,
375: G4~375,
375: E4~375,
6000`

// playTune(melody, Infinity)

const melody2 = tune`
300: C5^300,
300: D5^300,
300: E5^300,
300: F5^300,
300: G5^300,
300: E5^300,
300: F5^300,
300: A5^300,
300,
300: G5^300,
300,
300: E5^300,
300,
300: C5^300,
5400`

const soundFalling = tune`
162.16216216216216: E5^162.16216216216216 + A5~162.16216216216216,
162.16216216216216: A5~162.16216216216216,
162.16216216216216: A5~162.16216216216216,
162.16216216216216: A5~162.16216216216216,
162.16216216216216: E5^162.16216216216216 + A5~162.16216216216216,
162.16216216216216: A5~162.16216216216216,
162.16216216216216: A5~162.16216216216216,
162.16216216216216: A5~162.16216216216216,
162.16216216216216: E5^162.16216216216216 + A5~162.16216216216216,
3729.7297297297296`


const soundDogMove = tune`
78.94736842105263: A5-78.94736842105263,
78.94736842105263: B5-78.94736842105263,
2368.4210526315787`
const sound3 = tune`
500: C5/500 + A4~500,
500: B4/500 + G4~500,
500: G4/500 + E4~500,
500: F4/500 + D4~500,
500: E4~500,
500: D4~500,
500: E4~500,
500: D4~500,
12000`
const sound4 = tune`
68.3371298405467: D5-68.3371298405467,
68.3371298405467: E5-68.3371298405467,
68.3371298405467: F5-68.3371298405467,
68.3371298405467: G5-68.3371298405467,
68.3371298405467: A5-68.3371298405467,
68.3371298405467: B5-68.3371298405467,
1776.765375854214`
const sound5 = tune`...`
const sound6 = tune`...`
const sound7 = tune`...`
const sound8 = tune`...`
const sound9 = tune`...`
const sound10 = tune`...`


let level = 0
const levels = [
  map`
3EEEEEEEEE4
Q.....Q111W
Q.....Q999W
Q.....Q111W
Q.....Q161W
Q.....Q616W
Q...pbQ161W
TRRRRRRRRR5`]

setMap(levels[level])

setPushables({
  [player]: []
})


let score = 0;
addText(`Score: ${score}`, {
  x: 2,
  y: 1,
  color: color`3`
})


// Move left
onInput("a", () => {
  const _player = getFirst(player)
  const _bowl = getFirst(bowl)

  if(_bowl.x === 1)
    return;
  
  _player.x -= 1
  _bowl.x -= 1

  if(_player.x <= 0)
    _player.x = 2

  playTune(soundDogMove);
})

// Move right
onInput("d", () => {
  const _player = getFirst(player)
  const _bowl = getFirst(bowl)

  if(_bowl.x === 5)
    return;

  _player.x += 1
  _bowl.x += 1

  if(_player.x === 6)
    _player.x = 4;

  playTune(soundDogMove);
})

afterInput(() => {

})
